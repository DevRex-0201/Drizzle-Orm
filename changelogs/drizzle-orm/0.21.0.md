## Drizzle Kit 0.17.0 was released ðŸŽ‰

</br>

## Breaking changes

### Folder structure was migrated to newer version

---

Before running any new migrations `drizzle-kit` will ask you to upgrade in a first place

Migration file structure < 0.17.0

```plaintext
ðŸ“¦ <project root>
 â”” ðŸ“‚ migrations
    â”” ðŸ“‚ 20221207174503
       â”œ ðŸ“œ migration.sql
       â”œ ðŸ“œ snapshot.json
    â”” ðŸ“‚ 20230101104503
       â”œ ðŸ“œ migration.sql
       â”œ ðŸ“œ snapshot.json
```

Migration file structure >= 0.17.0

```plaintext
ðŸ“¦ <project root>
 â”” ðŸ“‚ migrations
    â”” ðŸ“‚ meta
      â”œ ðŸ“œ _journal.json
      â”œ ðŸ“œ 0000_snapshot.json
      â”œ ðŸ“œ 0001_snapshot.json
    â”” ðŸ“œ 0000_icy_stranger.sql
    â”” ðŸ“œ 0001_strange_avengers.sql
```

To easily migrate from previous folder structure to new you need to run `up` command in drizzle kit. It is a great helper to upgrade your migrations to new format on each drizzle kit major update

```bash
drizzle-kit up:<dialect> # dialects: `pg`, `mysql`, `sqlite`

# example for pg
drizzle-kit up:pg
```

</br>

## New Features

### New `drizzle-kit` command called `drop`

---

In a case you think some of migrations were generated in a wrong way or you have made migration simultaneously with other developers you can easily rollback it by running simple command

> **Warning**:
> Make sure, that you are dropping migrations, that were not applied to your database

```bash
drizzle-kit drop
```

This command will show you a list of all migrations you have and you'll need just to choose migration you want to drop. After that `drizzle-kit` will do all the hard work on deleting migration files

</br>

### New `drizzle-kit` option `--breakpoints` for `generate` and `introspect` command

---

In a case if some driver doesn't support running multiple quries in 1 execution you can use `--breakpoints`.

`drizzle-kit` will generate current sql

```sql
CREATE TABLE `users` (
  `id` int PRIMARY KEY NOT NULL,
  `full_name` text NOT NULL,
);
--> statement-breakpoint
CREATE TABLE `table` (
  `id` int PRIMARY KEY NOT NULL,
  `phone` int,
);
```

Using it `drizzle-orm` will split all sql files by statements and execute them separately

</br>

### Add `drizzle-kit intropect` for MySQL dialect

---

You can introspect your mysql database using `introspect:mysql` command

```bash
drizzle-kit introspect:mysql --out ./migrations --connectionString mysql://user:password@127.0.0.1:3306/database
```

</br>

## Bug Fixes and improvements

### Postgres dialect

- [pg] char is undefined during introspection [#6](https://github.com/drizzle-team/drizzle-kit-mirror/issues/9)
- when unknown type is detected, would be nice to emit a TODO comment instead of undefined [#8](https://github.com/drizzle-team/drizzle-kit-mirror/issues/8)
- "post_id" integer DEFAULT currval('posts_id_seq'::regclass) generates invalid TS [#7](https://github.com/drizzle-team/drizzle-kit-mirror/issues/7)
- "ip" INET NOT NULL is not supported [#6](https://github.com/drizzle-team/drizzle-kit-mirror/issues/6)
- "id" UUID NOT NULL DEFAULT uuid_generate_v4() type is not supported [#5](https://github.com/drizzle-team/drizzle-kit-mirror/issues/5)
- generated enums are not camel cased [#2](https://github.com/drizzle-team/drizzle-kit-mirror/issues/2)

### MySQL dialect

- Add `autoincrement` create, delete and update handling
- Add `on update current_timestamp` handling for timestamps
- Add data type changing, using `modify`
- Add `not null` changing, using `modify`
- Add `default` drop and create statements
- Fix `defaults` generation bugs, such as escaping, date strings, expressions, etc

---

## Drizzle ORM 0.21.0 was released ðŸŽ‰

1. Added support for new migration folder structure and breakpoints feature, described in drizzle-kit release section
2. Fix `onUpdateNow()` expression generation for default migration statement
